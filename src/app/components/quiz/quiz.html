<!-- src/app/components/quiz/quiz.html -->

<div class="quiz-container">
  <!-- Loading State -->
  @if (loading) {
    <div class="loading-container">
      <div class="spinner"></div>
      <p>Loading quiz...</p>
    </div>
  }

  <!-- Error State -->
  @if (error) {
    <div class="error-container">
      <div class="error-message">
        <h2>Oops! Something went wrong</h2>
        <p>{{ error }}</p>
        <button class="btn btn-primary" (click)="loadQuiz()">Try Again</button>
      </div>
    </div>
  }

  <!-- Quiz Content -->
  @if (!loading && !error && quizData && quizState) {
    <div class="quiz-content">
      
      <!-- Show Results -->
      @if (quizState.showResults) {
        <app-results 
          [quizData]="quizData"
          (restartQuiz)="onRestartQuiz()">
        </app-results>
      }

      <!-- Quiz Completion Screen -->
      @if (quizState.isCompleted && !quizState.showResults) {
        <div class="completion-container">
          <div class="completion-content">
            <div class="completion-icon">
              <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                <polyline points="22,4 12,14.01 9,11.01"></polyline>
              </svg>
            </div>
            <h1>Quiz Completed!</h1>
            <p>You've answered all {{ quizData.questions.length }} questions.</p>
            <p>Ready to see your results? Click the button below to find out how well you did!</p>
            <button class="btn btn-primary btn-large" (click)="quizService.showResults()">
              Show Results
            </button>
          </div>
        </div>
      }

      <!-- Active Quiz -->
      @if (!quizState.isCompleted && !quizState.showResults) {
        <div class="active-quiz">
          <!-- Header -->
          <div class="quiz-header">
            <div class="quiz-icon">
              <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path>
                <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path>
              </svg>
            </div>
            <h1>{{ quizData.title }}</h1>
            <p>{{ quizData.description }}</p>
          </div>

          <!-- Progress Bar -->
          <div class="progress-section">
            <div class="progress-info">
              <span>Question {{ quizState.currentQuestionIndex + 1 }} of {{ quizData.questions.length }}</span>
              <span>{{ Math.round(((quizState.currentQuestionIndex + 1) / quizData.questions.length) * 100) }}% Complete</span>
            </div>
            <div class="progress-bar">
              <div 
                class="progress-fill"
                [style.width.%]="((quizState.currentQuestionIndex + 1) / quizData.questions.length) * 100">
              </div>
            </div>
          </div>

          <!-- Question Component -->
          <app-question 
            [question]="quizData.questions[quizState.currentQuestionIndex]"
            [selectedAnswer]="quizState.selectedAnswers[quizData.questions[quizState.currentQuestionIndex].id]"
            [questionNumber]="quizState.currentQuestionIndex + 1"
            [isFirstQuestion]="quizState.currentQuestionIndex === 0"
            [isLastQuestion]="quizState.currentQuestionIndex === quizData.questions.length - 1"
            [totalQuestions]="quizData.questions.length">
          </app-question>

          <!-- Progress Summary -->
          <div class="progress-summary">
            <h3>Progress Summary:</h3>
            <div class="question-indicators">
              <div 
                *ngFor="let question of quizData.questions; let i = index"
                class="question-indicator"
                [ngClass]="{
                  'current': i === quizState.currentQuestionIndex,
                  'answered': quizService.isQuestionAnswered(i),
                  'unanswered': !quizService.isQuestionAnswered(i) && i !== quizState.currentQuestionIndex
                }">
                {{ i + 1 }}
              </div>
            </div>
            <p class="summary-text">
              Answered: {{ quizService.getTotalAnswered() }} / {{ quizData.questions.length }}
            </p>
          </div>
        </div>
      }
    </div>
  }
</div>